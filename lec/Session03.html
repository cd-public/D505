<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Jameson > Hendrik > Calvin">
  <title>K Nearest Neighbors</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-c1f635a6a944ce379414891b33bb93f0.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title"><span class="math inline">\(K\)</span> Nearest Neighbors</h1>
  <p class="subtitle">Applied Machine Learning</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Jameson &gt; Hendrik &gt; Calvin 
</div>
</div>
</div>

</section>
<section id="agenda" class="slide level2">
<h2>Agenda</h2>
<ol type="1">
<li>Review of Homeworks</li>
<li>A human understanding of regression</li>
<li>Dinner break</li>
<li>Preprocessing and BoxCox</li>
<li>The <span class="math inline">\(K\)</span>NN algorithm and the Confusion Matrix</li>
</ol>
</section>
<section>
<section id="homework" class="title-slide slide level1 center">
<h1>Homework</h1>

</section>
<section id="hw1" class="slide level2">
<h2>HW1</h2>
<ul>
<li>We need to work on writing quality.</li>
<li>We need to work on RMSE intepretation.</li>
<li>We need to work on using <code>summary</code> responsibly.</li>
<li>We need to work on applying lecture topics to leading questions.</li>
<li>We would benefit from use of the <a href="https://quarto.org/docs/reference/formats/html.html"><code>embed-resources</code></a> option in Quarto.</li>
</ul>
</section>
<section id="hw1-sols-posted" class="slide level2">
<h2>HW1 Sols Posted</h2>
<ul>
<li><a href="../hws/wine_of_pnw_sol.html">Here</a></li>
</ul>
<iframe src="../hws/wine_of_pnw_sol.html" height="500" width="800" title="Iframe Example">
</iframe>
</section>
<section id="hw2" class="slide level2">
<h2>HW2</h2>
<ul>
<li>Think</li>
<li>Pair</li>
<li>Share</li>
</ul>
</section></section>
<section>
<section id="today" class="title-slide slide level1 center">
<h1>Today</h1>

</section>
<section id="setup" class="slide level2">
<h2>Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a></a><span class="fu">library</span>(moderndive)</span>
<span id="cb1-3"><a></a><span class="fu">library</span>(class)</span>
<span id="cb1-4"><a></a><span class="fu">library</span>(caret)</span>
<span id="cb1-5"><a></a><span class="fu">library</span>(fastDummies)</span>
<span id="cb1-6"><a></a><span class="fu">library</span>(thematic)</span>
<span id="cb1-7"><a></a><span class="fu">theme_set</span>(<span class="fu">theme_dark</span>())</span>
<span id="cb1-8"><a></a><span class="fu">thematic_rmd</span>(<span class="at">bg =</span> <span class="st">"#111"</span>, <span class="at">fg =</span> <span class="st">"#eee"</span>, <span class="at">accent =</span> <span class="st">"#eee"</span>)</span>
<span id="cb1-9"><a></a>wine <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">gzcon</span>(<span class="fu">url</span>(<span class="st">"https://cd-public.github.io/D505/dat/wine.rds"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a></a>  <span class="fu">mutate</span>(<span class="at">lprice =</span> <span class="fu">log</span>(price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="reporting-impact-from-regressions" class="title-slide slide level1 center">
<h1>Reporting Impact from Regressions</h1>

</section>
<section id="correlation" class="slide level2">
<h2>Correlation</h2>
<p><a href="https://moderndive.com/5-regression.html"><em>Credit:</em> Modern Dive</a></p>
<p><a href="http://guessthecorrelation.com/">http://guessthecorrelation.com/</a> …my high score is 72 (Jameson 122)</p>

<img data-src="./images/correlation.png" class="r-stretch"></section>
<section id="calculating-correlation" class="slide level2">
<h2>Calculating correlation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>wine <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a></a>  <span class="fu">summarise</span>(<span class="at">cor_p=</span><span class="fu">cor</span>(price,points),<span class="at">cor_lp=</span><span class="fu">cor</span>(lprice,points))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  cor_p cor_lp
  &lt;dbl&gt;  &lt;dbl&gt;
1 0.404  0.624</code></pre>
</div>
</div>
</section>
<section id="exercise" class="slide level2">
<h2>Exercise</h2>
<ol type="1">
<li>Calculate the correlation between <span class="math inline">\(\log\)</span>(price) and points…</li>
<li>…by variety…</li>
<li>…for Oregon Chardonnay, Pinot Noir and Pinot Gris…</li>
<li>…in the same tibble!</li>
</ol>
</section>
<section id="solution" class="slide level2">
<h2>Solution</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>wine <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a></a>  <span class="fu">filter</span>(province<span class="sc">==</span><span class="st">"Oregon"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a></a>  <span class="fu">filter</span>(variety <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Chardonnay"</span>,<span class="st">"Pinot Noir"</span>,<span class="st">"Pinot Gris"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a></a>  <span class="fu">group_by</span>(variety) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a></a>  <span class="fu">summarise</span>(<span class="at">correlation=</span><span class="fu">cor</span>(lprice,points))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  variety    correlation
  &lt;chr&gt;            &lt;dbl&gt;
1 Chardonnay       0.642
2 Pinot Gris       0.490
3 Pinot Noir       0.591</code></pre>
</div>
</div>
</section>
<section id="visualizing-these-different-correlations" class="slide level2">
<h2>Visualizing these different correlations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>wine <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a></a>  <span class="fu">filter</span>(province<span class="sc">==</span><span class="st">"Oregon"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a></a>  <span class="fu">filter</span>(variety <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Chardonnay"</span>,<span class="st">"Pinot Noir"</span>,<span class="st">"Pinot Gris"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(points,lprice, <span class="at">color=</span>variety)) <span class="sc">+</span></span>
<span id="cb6-5"><a></a>    <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb6-6"><a></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>variety)<span class="sc">+</span></span>
<span id="cb6-7"><a></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
<section id="visualizing-these-different-correlations-output" class="slide level2 output-location-slide"><h2>Visualizing these different correlations</h2><div class="cell output-location-slide">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="Session03_files/figure-revealjs/unnamed-chunk-3-1.png" width="960"></p>
</figure>
</div>
</div>
</div></section><section id="graphing-residuals-bad" class="slide level2">
<h2>Graphing residuals (bad)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(price<span class="sc">~</span>points, <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>))</span>
<span id="cb7-2"><a></a><span class="fu">get_regression_points</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(points, residual))<span class="sc">+</span></span>
<span id="cb7-4"><a></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="Session03_files/figure-revealjs/unnamed-chunk-4-1.png" width="960" class="r-stretch"></section>
<section id="annotate" class="slide level2">
<h2>Annotate</h2>

<img data-src="images/spread.png" class="r-stretch"></section>
<section id="graphing-residuals-good" class="slide level2">
<h2>Graphing residuals (good)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(lprice<span class="sc">~</span>points, <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>))</span>
<span id="cb8-2"><a></a><span class="fu">get_regression_points</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(points, residual))<span class="sc">+</span></span>
<span id="cb8-4"><a></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="Session03_files/figure-revealjs/unnamed-chunk-5-1.png" width="960" class="r-stretch"></section>
<section id="interpreting-the-coefficients" class="slide level2">
<h2>Interpreting the coefficients</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(lprice<span class="sc">~</span>points, <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>))</span>
<span id="cb9-2"><a></a>pct <span class="ot">=</span> (<span class="fu">exp</span>(<span class="fu">coef</span>(model)[<span class="st">"points"</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb9-3"><a></a><span class="fu">c</span>(<span class="fu">coef</span>(model)[<span class="st">"points"</span>],pct) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    points     points 
0.09396111 9.85170227 </code></pre>
</div>
</div>
<ul>
<li>We logged the <em>dependent</em> variable (price)
<ul>
<li>A 1 point ratings increase = <code>9.85</code>%</li>
<li>That is, a percent change in rating to an <em>absolute</em> change in the dependent variable.</li>
</ul></li>
<li><span class="math inline">\((e^x - 1)*100\)</span></li>
</ul>
</section>
<section id="interpreting-the-coefficients-1" class="slide level2">
<h2>Interpreting the coefficients</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>m_yr <span class="ot">&lt;-</span> <span class="fu">lm</span>(lprice<span class="sc">~</span>year, <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>))</span>
<span id="cb11-2"><a></a>yr <span class="ot">=</span> (<span class="fu">exp</span>(<span class="fu">coef</span>(m_yr)[<span class="st">"year"</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb11-3"><a></a><span class="fu">c</span>(<span class="fu">coef</span>(m_yr)[<span class="st">"year"</span>],yr) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year       year 
0.01895092 1.91316309 </code></pre>
</div>
</div>
<ul>
<li>This is a <em>de facto</em> measure of inflation.</li>
</ul>
</section>
<section id="some-examples" class="slide level2">
<h2>Some Examples</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb13-2"><a></a>    <span class="fu">print</span>(<span class="fu">c</span>(x<span class="sc">/</span><span class="dv">100</span>, (<span class="fu">exp</span>(x<span class="sc">/</span><span class="dv">100</span>)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb13-3"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.010000 1.005017
[1] 0.020000 2.020134
[1] 0.030000 3.045453
[1] 0.040000 4.081077
[1] 0.05000 5.12711
[1] 0.060000 6.183655
[1] 0.070000 7.250818
[1] 0.080000 8.328707
[1] 0.090000 9.417428
[1]  0.10000 10.51709</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb15-2"><a></a>    <span class="fu">print</span>(<span class="fu">c</span>(x<span class="sc">/</span><span class="dv">010</span>, (<span class="fu">exp</span>(x<span class="sc">/</span><span class="dv">010</span>)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb15-3"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.10000 10.51709
[1]  0.20000 22.14028
[1]  0.30000 34.98588
[1]  0.40000 49.18247
[1]  0.50000 64.87213
[1]  0.60000 82.21188
[1]   0.7000 101.3753
[1]   0.8000 122.5541
[1]   0.9000 145.9603
[1]   1.0000 171.8282</code></pre>
</div>
</div>
</div></div>
</section>
<section id="pretty-print" class="slide level2">
<h2>Pretty Print</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="cf">for</span>(v <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"Chardonnay"</span>, <span class="st">"Pinot Gris"</span>,<span class="st">"Pinot Noir"</span>)){</span>
<span id="cb17-2"><a></a>  m <span class="ot">&lt;-</span> <span class="fu">lm</span>(lprice<span class="sc">~</span>points, <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>, variety<span class="sc">==</span>v))</span>
<span id="cb17-3"><a></a>  pct <span class="ot">&lt;-</span> <span class="fu">round</span>((<span class="fu">exp</span>(<span class="fu">coef</span>(m)[<span class="st">"points"</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb17-4"><a></a>  <span class="fu">print</span>(<span class="fu">str_c</span>(<span class="st">"For "</span>,v,<span class="st">", a 1 point ratings increase leads to a "</span>,pct,<span class="st">"% increase in price."</span>))</span>
<span id="cb17-5"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "For Chardonnay, a 1 point ratings increase leads to a 11.34% increase in price."
[1] "For Pinot Gris, a 1 point ratings increase leads to a 5.46% increase in price."
[1] "For Pinot Noir, a 1 point ratings increase leads to a 10.27% increase in price."</code></pre>
</div>
</div>
</section>
<section id="log-feature" class="slide level2">
<h2><span class="math inline">\(\log\)</span> feature</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(price<span class="sc">~</span>lpoints, <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">lpoints=</span><span class="fu">log</span>(points)))</span>
<span id="cb19-2"><a></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = price ~ lpoints, data = filter(wine, province == 
    "Oregon") %&gt;% mutate(lpoints = log(points)))

Coefficients:
(Intercept)      lpoints  
    -1419.0        324.4  </code></pre>
</div>
</div>
<ul>
<li>What does the <em>sign</em> (positive or negative) tell us?</li>
<li>Was <span class="math inline">\(\log\)</span> appropriate here?</li>
</ul>
</section>
<section id="percentages" class="slide level2">
<h2>Percentages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">coef</span>(model)[<span class="st">"lpoints"</span>]<span class="sc">/</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> lpoints 
3.243706 </code></pre>
</div>
</div>
<ul>
<li>Since we logged the IV (feature), a 1% ratings increase is a ~3.24 increase in price on average.</li>
<li>What are the units on that?</li>
</ul>
<p>Note: <span class="math display">\[
x/100
\]</span></p>
</section>
<section id="loglog-also-elasticity" class="slide level2">
<h2>LogLog (also elasticity)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(lprice<span class="sc">~</span>lpoints, <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">lpoints=</span><span class="fu">log</span>(points)))</span>
<span id="cb23-2"><a></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lprice ~ lpoints, data = filter(wine, province == 
    "Oregon") %&gt;% mutate(lpoints = log(points)))

Coefficients:
(Intercept)      lpoints  
    -33.770        8.298  </code></pre>
</div>
</div>
<p>…a 1% increase in ratings equals a <code>8.3</code>% increase in price on average</p>
</section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<ul>
<li>Only the dependent/response variable is log-transformed.
<ul>
<li>Exponentiate the coefficient.</li>
<li>Subtract one from this number</li>
<li>Multiply by 100.</li>
</ul></li>
<li>This gives the percent increase (or decrease).</li>
</ul>
</section>
<section id="units" class="slide level2">
<h2>Units</h2>
<ul>
<li>Change is per one-unit increase in the independent variable.
<ul>
<li>Here, independent is points.</li>
<li>Dependent is price.</li>
</ul></li>
</ul>
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<ul>
<li>For every 1% increase in the independent variable…
<ul>
<li>Basically, one point</li>
<li>Our dependent variable increases by about 8.3%.</li>
</ul></li>
<li>A $30 bottle of wine scoring 90 would be worth $32.50 as a 91.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="dv">30</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">8.3</span><span class="sc">/</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32.49</code></pre>
</div>
</div>
</section>
<section id="graphing-points-by-variety" class="slide level2">
<h2>Graphing points by variety</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>wine <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a></a>  <span class="fu">filter</span>(province<span class="sc">==</span><span class="st">"Oregon"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a></a>  <span class="fu">filter</span>(variety <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Chardonnay"</span>,<span class="st">"Pinot Noir"</span>,<span class="st">"Pinot Gris"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(variety,points))<span class="sc">+</span></span>
<span id="cb27-5"><a></a>    <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="Session03_files/figure-revealjs/unnamed-chunk-15-1.png" width="960" class="r-stretch"></section>
<section id="summary-1" class="slide level2">
<h2>Summary</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>(tmp <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a></a>  <span class="fu">filter</span>(province<span class="sc">==</span><span class="st">"Oregon"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a></a>  <span class="fu">filter</span>(variety <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Chardonnay"</span>,<span class="st">"Pinot Noir"</span>,<span class="st">"Pinot Gris"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a></a>  <span class="fu">group_by</span>(variety) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a></a>  <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(points)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  variety     mean
  &lt;chr&gt;      &lt;dbl&gt;
1 Chardonnay  89.7
2 Pinot Gris  88.5
3 Pinot Noir  89.5</code></pre>
</div>
</div>
<ul>
<li>What are the percentage differences here?</li>
</ul>
</section>
<section id="regression" class="slide level2">
<h2>Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(points<span class="sc">~</span>variety, </span>
<span id="cb30-2"><a></a>            <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>,variety <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Chardonnay"</span>,<span class="st">"Pinot Noir"</span>,<span class="st">"Pinot Gris"</span>)))</span>
<span id="cb30-3"><a></a><span class="fu">get_regression_table</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  term                estimate std_error statistic p_value lower_ci upper_ci
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 intercept             89.7       0.122    737.     0       89.5     90.0  
2 variety: Pinot Gris   -1.24      0.177     -7.03   0       -1.59    -0.894
3 variety: Pinot Noir   -0.256     0.132     -1.94   0.053   -0.515    0.003</code></pre>
</div>
</div>
<ul>
<li>What types of variables are we considering here?</li>
</ul>
</section>
<section id="assumptions-of-linear-regression" class="slide level2">
<h2>Assumptions of linear regression</h2>
<ol type="1">
<li><strong>L</strong>inearity of relationship between variables</li>
<li><strong>I</strong>ndependence of the residuals</li>
<li><strong>N</strong>ormality of the residuals</li>
<li><strong>E</strong>quality of variance of the residuals</li>
</ol>
</section>
<section id="linearity-of-relationship" class="slide level2">
<h2>Linearity of relationship</h2>
<p><a href="https://moderndive.com/5-regression.html"><em>Credit:</em> Modern Dive</a></p>

<img data-src="./images/non-linear.png" class="r-stretch"><p>What would the residuals look like?</p>
</section>
<section id="independence" class="slide level2">
<h2>Independence</h2>
<ul>
<li><p>Given our original model of <span class="math display">\[
\log(\text{price})=m*\text{Points}+b
\]</span></p></li>
<li><p>are there any problems with independence?</p></li>
<li><p>How could we check?</p></li>
</ul>
</section>
<section id="normality" class="slide level2">
<h2>Normality</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(lprice<span class="sc">~</span>points, <span class="fu">filter</span>(wine,province<span class="sc">==</span><span class="st">"Oregon"</span>))</span>
<span id="cb32-2"><a></a><span class="fu">get_regression_points</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(residual))<span class="sc">+</span></span>
<span id="cb32-4"><a></a>    <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="Session03_files/figure-revealjs/unnamed-chunk-18-1.png" width="960" class="r-stretch"></section>
<section id="equality-of-variance" class="slide level2">
<h2>Equality of variance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a><span class="fu">get_regression_points</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(points, residual))<span class="sc">+</span></span>
<span id="cb33-3"><a></a>    <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="Session03_files/figure-revealjs/unnamed-chunk-19-1.png" width="960" class="r-stretch"></section>
<section id="no-equality-in-the-variance" class="slide level2">
<h2>No equality in the variance</h2>
<p><a href="https://moderndive.com/5-regression.html"><em>Credit:</em> Modern Dive</a> (click)</p>

<img data-src="./images/unequal-variance.png" class="r-stretch"></section></section>
<section id="dinner" class="title-slide slide level1 center">
<h1>Dinner</h1>

<img data-src="./images/comic3.png" class="r-stretch"></section>

<section>
<section id="preprocessing-and-boxcox" class="title-slide slide level1 center">
<h1>Preprocessing and BoxCox</h1>

</section>
<section id="setup-1" class="slide level2">
<h2>Setup</h2>
<ul>
<li>Pivot to pinot.
<ul>
<li>Say “<span class="math inline">\(\pi^0\)</span>”</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>wine <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">gzcon</span>(<span class="fu">url</span>(<span class="st">"https://cd-public.github.io/D505/dat/pinot_orig.rds"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preprocessing" class="slide level2">
<h2>Preprocessing</h2>
<ul>
<li>Box-Cox transformations use maximum likelihood estimate to estimate value for <span class="math inline">\(\lambda\)</span></li>
</ul>
<p><span class="math display">\[
y(\lambda) = \frac{x^{\lambda}-1}{\lambda}
\]</span></p>
<ul>
<li>The goal is to make data seem more like a normal distribution.</li>
</ul>
</section>
<section id="in-r" class="slide level2">
<h2>in R</h2>
<ul>
<li>LaTeX</li>
</ul>
<p><span class="math display">\[
y(\lambda) = \frac{x^{\lambda}-1}{\lambda}
\]</span></p>
<ul>
<li>R</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>y <span class="ot">&lt;-</span> <span class="cf">function</span>(l) {</span>
<span id="cb35-2"><a></a>  r <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb35-3"><a></a>    (x <span class="sc">**</span> l <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span>l</span>
<span id="cb35-4"><a></a>  }</span>
<span id="cb35-5"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="examples" class="slide level2">
<h2>Examples</h2>
<ul>
<li>When <span class="math inline">\(\lambda=1\)</span>, there is no transformation</li>
</ul>
<p><span class="math display">\[
y(1) = \frac{x^{\lambda}-1}{\lambda} =
      \frac{x^{1}-1}{1} =
        x-1 \approx x
\]</span></p>
<p><span class="math display">\[
f = y(-1) \implies f(x) \approx x
\]</span></p>
</section>
<section id="examples-1" class="slide level2">
<h2>Examples</h2>
<ul>
<li>When <span class="math inline">\(\lambda=0\)</span>, it is log transformed</li>
</ul>
<p><span class="math display">\[
y(0) = \frac{x^{\lambda}-1}{\lambda} =
      \frac{x^{0}-1}{0}
\]</span></p>
<p><span class="math display">\[
f = y(0) \implies f(x) \approx \log(x)
\]</span></p>
<ul>
<li>Zero is a special case, but using a little thing called “calculus” this sorta makes sense.</li>
<li>Basically, negative infinity at 0, then increase slowly once positive.</li>
</ul>
</section>
<section id="lambda-0" class="slide level2">
<h2><span class="math inline">\(\lambda = 0\)</span></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb36-2"><a></a>  <span class="fu">print</span>(x<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb36-3"><a></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb36-4"><a></a>    f <span class="ot">=</span> <span class="fu">y</span>(l<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb36-5"><a></a>    <span class="fu">print</span>(<span class="fu">c</span>(l<span class="sc">/</span><span class="dv">100</span>, x<span class="sc">/</span><span class="dv">10</span>, <span class="fu">f</span>(x<span class="sc">/</span><span class="dv">10</span>), <span class="fu">log</span>(x<span class="sc">/</span><span class="dv">10</span>), <span class="fu">f</span>(x<span class="sc">/</span><span class="dv">10</span>) <span class="sc">-</span> <span class="fu">log</span>(x<span class="sc">/</span><span class="dv">10</span>)))</span>
<span id="cb36-6"><a></a>  }</span>
<span id="cb36-7"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1
[1]  0.03000000  0.10000000 -2.22485664 -2.30258509  0.07772845
[1]  0.02000000  0.10000000 -2.25037070 -2.30258509  0.05221439
[1]  0.01000000  0.10000000 -2.27627790 -2.30258509  0.02630719
[1] 0.2
[1]  0.0300000  0.2000000 -1.5712014 -1.6094379  0.0382365
[1]  0.0200000  0.2000000 -1.5838107 -1.6094379  0.0256272
[1]  0.01000000  0.20000000 -1.59655566 -1.60943791  0.01288225
[1] 0.3
[1]  0.03000000  0.30000000 -1.18248898 -1.20397280  0.02148382
[1]  0.02000000  0.30000000 -1.18959295 -1.20397280  0.01437985
[1]  0.010000000  0.300000000 -1.196754051 -1.203972804  0.007218753</code></pre>
</div>
</div>
</section>
<section id="examples-2" class="slide level2">
<h2>Examples</h2>
<p><span class="math display">\[
y(1) = \frac{x^{\lambda}-1}{\lambda} =
      \frac{x^{.5}-1}{.5} =
      2\times(\sqrt{x}-1) \approx \sqrt{x}
\]</span></p>
<p><span class="math display">\[
f = y(.5) \implies f(x) \approx \sqrt{x}
\]</span></p>
</section>
<section id="examples-3" class="slide level2">
<h2>Examples</h2>
<ul>
<li>When <span class="math inline">\(\lambda=-1\)</span>, it is an inverse</li>
</ul>
<p><span class="math display">\[
y(1) = \frac{x^{\lambda}-1}{\lambda} =
      \frac{x^{-1}-1}{-1} =
      \frac{x^{-1}}{-1}+\frac{-1}{-1} =
      \frac{1}{-x}-1 = -x
\]</span> <span class="math display">\[
f = y(.5) \implies f(x) \approx -x
\]</span></p>
</section>
<section id="just-use-the-function" class="slide level2">
<h2>Just use the function</h2>
<ul>
<li>R: envstats</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a><span class="fu">library</span>(envstats)</span>
<span id="cb38-2"><a></a></span>
<span id="cb38-3"><a></a><span class="co"># Example data</span></span>
<span id="cb38-4"><a></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb38-5"><a></a></span>
<span id="cb38-6"><a></a><span class="co"># Apply Box-Cox transformation</span></span>
<span id="cb38-7"><a></a>boxcox_result <span class="ot">&lt;-</span> <span class="fu">boxcoxTransform</span>(data)</span>
<span id="cb38-8"><a></a></span>
<span id="cb38-9"><a></a><span class="co"># Print the result</span></span>
<span id="cb38-10"><a></a><span class="fu">print</span>(boxcox_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="just-use-the-function-1" class="slide level2">
<h2>Just use the function</h2>
<ul>
<li>Py: scipy.stats</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a></a><span class="im">from</span> scipy.stats <span class="im">import</span> boxcox</span>
<span id="cb39-2"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb39-3"><a></a></span>
<span id="cb39-4"><a></a><span class="co"># Example data</span></span>
<span id="cb39-5"><a></a>data <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb39-6"><a></a></span>
<span id="cb39-7"><a></a><span class="co"># Apply Box-Cox transformation</span></span>
<span id="cb39-8"><a></a>boxcox_result, lambda_value <span class="op">=</span> boxcox(data)</span>
<span id="cb39-9"><a></a></span>
<span id="cb39-10"><a></a><span class="co"># Print the result</span></span>
<span id="cb39-11"><a></a><span class="bu">print</span>(<span class="st">"Transformed data:"</span>, boxcox_result)</span>
<span id="cb39-12"><a></a><span class="bu">print</span>(<span class="st">"Lambda value:"</span>, lambda_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="on-python" class="slide level2">
<h2>On Python</h2>
<ul>
<li>I like the Python <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.boxcox.html">boxcox documentation</a>:</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode numberSource haskell number-lines code-with-copy"><code class="sourceCode haskell"><span id="cb40-1"><a></a>y <span class="ot">=</span> (x<span class="op">**</span>lmbda <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> lmbda,  for lmbda <span class="op">!=</span> <span class="dv">0</span></span>
<span id="cb40-2"><a></a>    <span class="fu">log</span>(x),                  for lmbda <span class="ot">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="caret-preprocessing-is-so-easy" class="slide level2">
<h2>Caret preprocessing is so easy!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a>wine <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a></a>  <span class="fu">preProcess</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"BoxCox"</span>,<span class="st">"center"</span>,<span class="st">"scale"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a></a>  <span class="fu">predict</span>(wine) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a></a>  <span class="fu">select</span>(<span class="sc">-</span>description) <span class="sc">%&gt;%</span> </span>
<span id="cb41-5"><a></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    province      price    points        year    taster_name
1     Oregon  0.7146905 -1.033841 -0.03425331   Paul Gregutt
2     Oregon -1.4139991 -1.033841  0.33313680   Paul Gregutt
3 California  0.8225454 -1.033841 -0.40146088 Virginie Boone
4     Oregon  0.2408520 -1.367723 -0.76848588   Paul Gregutt
5     Oregon -1.2418658 -1.367723 -1.13532834   Paul Gregutt
6     Oregon -1.0109945 -1.367723  1.06846470   Paul Gregutt</code></pre>
</div>
</div>
</section>
<section id="or-is-it" class="slide level2">
<h2>Or is it?</h2>
<p>But wait… what is wrong here?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a>wino <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a></a>  <span class="fu">mutate</span>(<span class="at">year_f =</span> <span class="fu">as.factor</span>(year))</span>
<span id="cb43-3"><a></a></span>
<span id="cb43-4"><a></a>wino <span class="ot">&lt;-</span> wino <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a></a>  <span class="fu">preProcess</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"BoxCox"</span>,<span class="st">"center"</span>,<span class="st">"scale"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-6"><a></a>  <span class="fu">predict</span>(wino)</span>
<span id="cb43-7"><a></a></span>
<span id="cb43-8"><a></a><span class="fu">head</span>(wino <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"year"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         year year_f
1 -0.03425331   2012
2  0.33313680   2013
3 -0.40146088   2011
4 -0.76848588   2010
5 -1.13532834   2009
6  1.06846470   2015</code></pre>
</div>
</div>
<ul>
<li>Are years normally distributed?</li>
</ul>
</section></section>
<section>
<section id="the-knn-algorithm" class="title-slide slide level1 center">
<h1>The <span class="math inline">\(K\)</span>NN Algorithm</h1>

</section>
<section id="algorithm" class="slide level2 smaller">
<h2>Algorithm</h2>
<ol type="1">
<li>Load the data</li>
<li>Initialize <span class="math inline">\(K\)</span> to your chosen number of neighbors</li>
<li>For each example in the data</li>
</ol>
<ul>
<li>Calculate the distance between the query example and the current example from the data.</li>
<li>Add the distance and the index of the example to an ordered collection</li>
</ul>
<ol start="4" type="1">
<li>Sort the ordered collection of distances and indices from smallest to largest (in ascending order) by the distances</li>
<li>Pick the first <span class="math inline">\(K\)</span> entries from the sorted collection</li>
<li>Get the labels of the selected <span class="math inline">\(K\)</span> entries</li>
<li>If regression, return the mean of the <span class="math inline">\(K\)</span> labels</li>
<li>If classification, return the mode of the <span class="math inline">\(K\)</span> labels</li>
</ol>
</section>
<section id="basis" class="slide level2">
<h2>Basis</h2>
<ul>
<li>We assume:
<ul>
<li>Existing datapoints in something we think of as a space
<ul>
<li>That is, probably two numerical value per point in a coordinate plane</li>
<li>Categorical is fine - think a Punnett square</li>
</ul></li>
<li>Existing datapoints are labelled
<ul>
<li>Numerical or categorical still fine!</li>
</ul></li>
</ul></li>
<li>To visualize, we will have a 2d space with color labels.</li>
</ul>
</section>
<section id="lets-draw-it" class="slide level2">
<h2>Let’s draw it</h2>
<p><a title="Antti Ajanki AnAj, CC BY-SA 3.0 <http://creativecommons.org/licenses/by-sa/3.0/>, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:KnnClassification.svg"><img style="background-color:white;" width="50%" alt="KnnClassification" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/KnnClassification.svg/256px-KnnClassification.svg.png?20101222011435"></a></p>
</section>
<section id="lets-draw-it-2" class="slide level2">
<h2>Let’s draw it 2</h2>
<p><a title="Paolo Bonfini, CC BY-SA 4.0 <https://creativecommons.org/licenses/by-sa/4.0>, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:KNN_decision_surface_animation.gif"><img width="100%" alt="KNN decision surface animation" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/KNN_decision_surface_animation.gif/512px-KNN_decision_surface_animation.gif?20240718130312"></a></p>
</section>
<section id="lets-draw-it-3" class="slide level2">
<h2>Let’s draw it 3</h2>

<img data-src="https://media.geeksforgeeks.org/wp-content/uploads/20231207103856/KNN-Algorithm-(1).png" class="r-stretch"><p><a href="https://www.geeksforgeeks.org/k-nearest-neighbours/">G4G</a></p>
</section>
<section id="engineering-some-features" class="slide level2">
<h2>Engineering some features</h2>
<ul>
<li>Create an “other” for most tasters.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a>wino <span class="ot">&lt;-</span> wino <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a></a>  <span class="fu">mutate</span>(<span class="at">taster_name =</span> <span class="fu">fct_lump</span>(taster_name,<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engineering-some-features-1" class="slide level2">
<h2>Engineering some features</h2>
<ul>
<li>Create dummys for years, tasters</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a></a>wino <span class="ot">&lt;-</span> wino <span class="sc">%&gt;%</span> <span class="fu">dummy_cols</span>(</span>
<span id="cb46-2"><a></a>    <span class="at">select_columns =</span> <span class="fu">c</span>(<span class="st">"year_f"</span>,<span class="st">"taster_name"</span>),</span>
<span id="cb46-3"><a></a>    <span class="at">remove_most_frequent_dummy =</span> T, </span>
<span id="cb46-4"><a></a>    <span class="at">remove_selected_columns =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engineering-some-features-2" class="slide level2">
<h2>Engineering some features</h2>
<ul>
<li>Convert everything to snake case.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a>wino <span class="ot">&lt;-</span> wino <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a></a>  <span class="fu">rename_all</span>(<span class="fu">funs</span>(<span class="fu">tolower</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a></a>  <span class="fu">rename_all</span>(<span class="fu">funs</span>(<span class="fu">str_replace_all</span>(., <span class="st">"-"</span>, <span class="st">"_"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a></a>  <span class="fu">rename_all</span>(<span class="fu">funs</span>(<span class="fu">str_replace_all</span>(., <span class="st">" "</span>, <span class="st">"_"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engineering-some-features-3" class="slide level2">
<h2>Engineering some features</h2>
<ul>
<li>Add indicators for 3 tasting notes.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a></a>wino <span class="ot">&lt;-</span> wino <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a></a>  <span class="fu">mutate</span>(<span class="at">note_cherry =</span> <span class="fu">str_detect</span>(description,<span class="st">"cherry"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a></a>  <span class="fu">mutate</span>(<span class="at">note_chocolate =</span> <span class="fu">str_detect</span>(description,<span class="st">"chocolate"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a></a>  <span class="fu">mutate</span>(<span class="at">note_earth =</span> <span class="fu">str_detect</span>(description,<span class="st">"earth"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a></a>  <span class="fu">select</span>(<span class="sc">-</span>description)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="engineering-some-features-4" class="slide level2">
<h2>Engineering some features</h2>
<ul>
<li>Let’s see it</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a><span class="fu">head</span>(wino) <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    province      price    points        year year_f_1996 year_f_1997
1     Oregon  0.7146905 -1.033841 -0.03425331           0           0
2     Oregon -1.4139991 -1.033841  0.33313680           0           0
3 California  0.8225454 -1.033841 -0.40146088           0           0
4     Oregon  0.2408520 -1.367723 -0.76848588           0           0
5     Oregon -1.2418658 -1.367723 -1.13532834           0           0
6     Oregon -1.0109945 -1.367723  1.06846470           0           0</code></pre>
</div>
</div>
</section>
<section id="split" class="slide level2">
<h2>Split</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a><span class="fu">set.seed</span>(<span class="dv">505</span>)</span>
<span id="cb51-2"><a></a>wine_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(wino<span class="sc">$</span>province, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-3"><a></a>train <span class="ot">&lt;-</span> wino[ wine_index, ]</span>
<span id="cb51-4"><a></a>test <span class="ot">&lt;-</span> wino[<span class="sc">-</span>wine_index, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simple-model" class="slide level2">
<h2>Simple model</h2>
<ul>
<li>Specify a <span class="math inline">\(K\)</span>NN model.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">knn</span>(</span>
<span id="cb52-2"><a></a>  <span class="at">train =</span> <span class="fu">select</span>(train,<span class="sc">-</span>province), </span>
<span id="cb52-3"><a></a>  <span class="at">test =</span> <span class="fu">select</span>(test,<span class="sc">-</span>province), </span>
<span id="cb52-4"><a></a>  <span class="at">k=</span><span class="dv">5</span>, </span>
<span id="cb52-5"><a></a>  <span class="at">cl =</span> train<span class="sc">$</span>province)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="confusion-matrix" class="slide level2">
<h2>Confusion matrix</h2>
<ul>
<li>Let’s look at Kappa.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a><span class="fu">confusionMatrix</span>(fit,<span class="fu">factor</span>(test<span class="sc">$</span>province))<span class="sc">$</span>overall</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Accuracy          Kappa  AccuracyLower  AccuracyUpper   AccuracyNull 
     0.9360430      0.9012588      0.9232355      0.9472929      0.4728033 
AccuracyPValue  McnemarPValue 
     0.0000000            NaN </code></pre>
</div>
</div>
</section>
<section id="kappa-kappa-statistic" class="slide level2">
<h2>Kappa <span class="math inline">\(\kappa\)</span> statistic</h2>
<blockquote>
<p>Kappa statistic is a measurement of the agreement for categorical items Kappa can be used to assess the performance of kNN algorithm.</p>
</blockquote>
<p><span class="math display">\[
\kappa = \dfrac{P(A)-P(E)}{1 - P(E)}
\]</span> &gt; where <span class="math inline">\(P(A\)</span>)$ is the relative observed agreement among raters, and <span class="math inline">\(P(E)\)</span> is the proportion of agreement expected between the classifier and the ground truth by chance. <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC4916348/">src</a></p>
</section>
<section id="kappa-kappa-statistic-1" class="slide level2">
<h2>Kappa <span class="math inline">\(\kappa\)</span> statistic</h2>
<p>Compares observed accuracy against what would be expected by a random classifier.</p>
<ul>
<li>&lt; 0.2 (not so good)</li>
<li>0.21 - 0.4 (ok)</li>
<li>0.41 - 0.6 (pretty good)</li>
<li>0.6 - 0.8 (great)</li>
<li>&gt; 0.8 (almost perfect)</li>
</ul>
<p>…whoa! What’s going on here?</p>
</section></section>
<section>
<section id="overfitting-or-a-leak" class="title-slide slide level1 center">
<h1>Overfitting… or a leak?</h1>

</section>
<section id="review-the-dataframe" class="slide level2">
<h2>Review the dataframe</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a></a><span class="fu">summary</span>(wino)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   province             price              points               year        
 Length:8380        Min.   :-3.31001   Min.   :-3.289952   Min.   :-5.8877  
 Class :character   1st Qu.:-0.62250   1st Qu.:-0.696100   1st Qu.:-0.4015  
 Mode  :character   Median : 0.05057   Median :-0.009039   Median : 0.3331  
                    Mean   : 0.00000   Mean   : 0.000000   Mean   : 0.0000  
                    3rd Qu.: 0.57013   3rd Qu.: 0.693463   3rd Qu.: 0.7007  
                    Max.   : 7.30609   Max.   : 2.893605   Max.   : 1.0685  
  year_f_1996         year_f_1997         year_f_1998        year_f_1999      
 Min.   :0.0000000   Min.   :0.0000000   Min.   :0.000000   Min.   :0.000000  
 1st Qu.:0.0000000   1st Qu.:0.0000000   1st Qu.:0.000000   1st Qu.:0.000000  
 Median :0.0000000   Median :0.0000000   Median :0.000000   Median :0.000000  
 Mean   :0.0001193   Mean   :0.0002387   Mean   :0.008353   Mean   :0.002029  
 3rd Qu.:0.0000000   3rd Qu.:0.0000000   3rd Qu.:0.000000   3rd Qu.:0.000000  
 Max.   :1.0000000   Max.   :1.0000000   Max.   :1.000000   Max.   :1.000000  
  year_f_2000        year_f_2001        year_f_2002        year_f_2003       
 Min.   :0.000000   Min.   :0.000000   Min.   :0.000000   Min.   :0.0000000  
 1st Qu.:0.000000   1st Qu.:0.000000   1st Qu.:0.000000   1st Qu.:0.0000000  
 Median :0.000000   Median :0.000000   Median :0.000000   Median :0.0000000  
 Mean   :0.001074   Mean   :0.000358   Mean   :0.000358   Mean   :0.0001193  
 3rd Qu.:0.000000   3rd Qu.:0.000000   3rd Qu.:0.000000   3rd Qu.:0.0000000  
 Max.   :1.000000   Max.   :1.000000   Max.   :1.000000   Max.   :1.0000000  
  year_f_2004        year_f_2005       year_f_2006       year_f_2007     
 Min.   :0.000000   Min.   :0.00000   Min.   :0.00000   Min.   :0.00000  
 1st Qu.:0.000000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.00000  
 Median :0.000000   Median :0.00000   Median :0.00000   Median :0.00000  
 Mean   :0.002029   Mean   :0.01539   Mean   :0.01957   Mean   :0.01432  
 3rd Qu.:0.000000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.00000  
 Max.   :1.000000   Max.   :1.00000   Max.   :1.00000   Max.   :1.00000  
  year_f_2008       year_f_2009       year_f_2010      year_f_2011     
 Min.   :0.00000   Min.   :0.00000   Min.   :0.0000   Min.   :0.00000  
 1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:0.00000  
 Median :0.00000   Median :0.00000   Median :0.0000   Median :0.00000  
 Mean   :0.02733   Mean   :0.04129   Mean   :0.0599   Mean   :0.06945  
 3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.0000   3rd Qu.:0.00000  
 Max.   :1.00000   Max.   :1.00000   Max.   :1.0000   Max.   :1.00000  
  year_f_2012      year_f_2013      year_f_2015      taster_name_jim_gordon
 Min.   :0.0000   Min.   :0.0000   Min.   :0.00000   Min.   :0.00000       
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.00000       
 Median :0.0000   Median :0.0000   Median :0.00000   Median :0.00000       
 Mean   :0.1796   Mean   :0.2171   Mean   :0.09726   Mean   :0.06563       
 3rd Qu.:0.0000   3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.00000       
 Max.   :1.0000   Max.   :1.0000   Max.   :1.00000   Max.   :1.00000       
 taster_name_matt_kettmann taster_name_other taster_name_roger_voss
 Min.   :0.0000            Min.   :0.00000   Min.   :0.0000        
 1st Qu.:0.0000            1st Qu.:0.00000   1st Qu.:0.0000        
 Median :0.0000            Median :0.00000   Median :0.0000        
 Mean   :0.1826            Mean   :0.06993   Mean   :0.1415        
 3rd Qu.:0.0000            3rd Qu.:0.00000   3rd Qu.:0.0000        
 Max.   :1.0000            Max.   :1.00000   Max.   :1.0000        
 taster_name_virginie_boone   cherry        chocolate         earth        
 Min.   :0.0000             Mode :logical   Mode :logical   Mode :logical  
 1st Qu.:0.0000             FALSE:5017      FALSE:7830      FALSE:7030     
 Median :0.0000             TRUE :3363      TRUE :550       TRUE :1350     
 Mean   :0.2223                                                            
 3rd Qu.:0.0000                                                            
 Max.   :1.0000                                                            </code></pre>
</div>
</div>
</section>
<section id="determine-what-dominates" class="slide level2">
<h2>Determine what dominates</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a></a>omit <span class="ot">&lt;-</span> <span class="cf">function</span>(prefix) {</span>
<span id="cb57-2"><a></a>  train <span class="ot">&lt;-</span> <span class="fu">select</span>(train, <span class="sc">-</span><span class="fu">starts_with</span>(prefix))</span>
<span id="cb57-3"><a></a>  test <span class="ot">&lt;-</span> <span class="fu">select</span>(test, <span class="sc">-</span><span class="fu">starts_with</span>(prefix))</span>
<span id="cb57-4"><a></a>  fit <span class="ot">&lt;-</span> <span class="fu">knn</span>(</span>
<span id="cb57-5"><a></a>    <span class="at">train =</span> <span class="fu">select</span>(train,<span class="sc">-</span>province), </span>
<span id="cb57-6"><a></a>    <span class="at">test =</span> <span class="fu">select</span>(test,<span class="sc">-</span>province), </span>
<span id="cb57-7"><a></a>    <span class="at">k=</span><span class="dv">5</span>, </span>
<span id="cb57-8"><a></a>    <span class="at">cl =</span> train<span class="sc">$</span>province)</span>
<span id="cb57-9"><a></a>  <span class="fu">confusionMatrix</span>(fit,<span class="fu">factor</span>(test<span class="sc">$</span>province))<span class="sc">$</span>overall</span>
<span id="cb57-10"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test" class="slide level2">
<h2>Test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a><span class="fu">c</span>(<span class="fu">omit</span>(<span class="st">'year'</span>)[<span class="st">"Kappa"</span>], <span class="fu">omit</span>(<span class="st">'note'</span>)[<span class="st">"Kappa"</span>], <span class="fu">omit</span>(<span class="st">'taster'</span>)[<span class="st">"Kappa"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Kappa     Kappa     Kappa 
0.9318353 0.8984893 0.3475146 </code></pre>
</div>
</div>
</section>
<section id="fixing-the-leak" class="slide level2">
<h2>Fixing the leak</h2>
<ul>
<li>Dastardly humans, always existing in a physical location.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a>train <span class="ot">&lt;-</span> <span class="fu">select</span>(train, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"taster"</span>))</span>
<span id="cb60-2"><a></a>test <span class="ot">&lt;-</span> <span class="fu">select</span>(test, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"taster"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rerun" class="slide level2">
<h2>Rerun</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">knn</span>(</span>
<span id="cb61-2"><a></a>  <span class="at">train =</span> <span class="fu">select</span>(train,<span class="sc">-</span>province), </span>
<span id="cb61-3"><a></a>  <span class="at">test =</span> <span class="fu">select</span>(test,<span class="sc">-</span>province), </span>
<span id="cb61-4"><a></a>  <span class="at">k=</span><span class="dv">5</span>, </span>
<span id="cb61-5"><a></a>  <span class="at">cl =</span> train<span class="sc">$</span>province)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="confusion-matrix-1" class="slide level2">
<h2>Confusion matrix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a></a><span class="fu">confusionMatrix</span>(fit,<span class="fu">factor</span>(test<span class="sc">$</span>province))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

                   Reference
Prediction          Burgundy California Casablanca_Valley Marlborough New_York
  Burgundy               125         42                 4           7        2
  California              53        586                 8          15        5
  Casablanca_Valley        2          2                 0           0        1
  Marlborough              3          5                 1           4        6
  New_York                 0          3                 3           3        3
  Oregon                  55        153                10          16        9
                   Reference
Prediction          Oregon
  Burgundy              60
  California           204
  Casablanca_Valley      2
  Marlborough           10
  New_York               3
  Oregon               268

Overall Statistics
                                          
               Accuracy : 0.5894          
                 95% CI : (0.5653, 0.6131)
    No Information Rate : 0.4728          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.3512          
                                          
 Mcnemar's Test P-Value : 0.002573        

Statistics by Class:

                     Class: Burgundy Class: California Class: Casablanca_Valley
Sensitivity                  0.52521            0.7408                 0.000000
Specificity                  0.91986            0.6769                 0.995750
Pos Pred Value               0.52083            0.6728                 0.000000
Neg Pred Value               0.92114            0.7444                 0.984394
Prevalence                   0.14226            0.4728                 0.015541
Detection Rate               0.07472            0.3503                 0.000000
Detection Prevalence         0.14345            0.5206                 0.004184
Balanced Accuracy            0.72254            0.7089                 0.497875
                     Class: Marlborough Class: New_York Class: Oregon
Sensitivity                    0.088889        0.115385        0.4899
Specificity                    0.984644        0.992714        0.7842
Pos Pred Value                 0.137931        0.200000        0.5245
Neg Pred Value                 0.975061        0.986128        0.7599
Prevalence                     0.026898        0.015541        0.3270
Detection Rate                 0.002391        0.001793        0.1602
Detection Prevalence           0.017334        0.008966        0.3054
Balanced Accuracy              0.536766        0.554049        0.6371</code></pre>
</div>
</div>
</section>
<section id="with-parameter-tuning-over-k" class="slide level2">
<h2>With parameter tuning over <span class="math inline">\(K\)</span></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">train</span>(province <span class="sc">~</span> .,</span>
<span id="cb64-2"><a></a>             <span class="at">data =</span> train, </span>
<span id="cb64-3"><a></a>             <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb64-4"><a></a>             <span class="at">tuneLength =</span> <span class="dv">15</span>,</span>
<span id="cb64-5"><a></a>             <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">number =</span> <span class="dv">1</span>)) <span class="co"># default bootstrap</span></span>
<span id="cb64-6"><a></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k-Nearest Neighbors 

6707 samples
  25 predictor
   6 classes: 'Burgundy', 'California', 'Casablanca_Valley', 'Marlborough', 'New_York', 'Oregon' 

No pre-processing
Resampling: Bootstrapped (1 reps) 
Summary of sample sizes: 6707 
Resampling results across tuning parameters:

  k   Accuracy   Kappa    
   5  0.5709076  0.3232838
   7  0.5733387  0.3240488
   9  0.5765802  0.3272905
  11  0.5806321  0.3279290
  13  0.5846840  0.3290006
  15  0.5972447  0.3483091
  17  0.5964344  0.3425932
  19  0.6017018  0.3491558
  21  0.6077796  0.3567900
  23  0.6073744  0.3530166
  25  0.6069692  0.3503344
  27  0.6089951  0.3522232
  29  0.6077796  0.3483464
  31  0.6102107  0.3513470
  33  0.6094003  0.3491499

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was k = 31.</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix-2" class="slide level2">
<h2>Confusion Matrix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a></a><span class="fu">confusionMatrix</span>(<span class="fu">predict</span>(fit, test),<span class="fu">factor</span>(test<span class="sc">$</span>province))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

                   Reference
Prediction          Burgundy California Casablanca_Valley Marlborough New_York
  Burgundy               114         19                 4           6        1
  California              69        682                 9          14        9
  Casablanca_Valley        0          1                 0           0        0
  Marlborough              1          0                 3           3        0
  New_York                 1          0                 0           0        1
  Oregon                  53         89                10          22       15
                   Reference
Prediction          Oregon
  Burgundy              50
  California           252
  Casablanca_Valley      1
  Marlborough            3
  New_York               0
  Oregon               241

Overall Statistics
                                          
               Accuracy : 0.6222          
                 95% CI : (0.5985, 0.6455)
    No Information Rate : 0.4728          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.3774          
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: Burgundy Class: California Class: Casablanca_Valley
Sensitivity                  0.47899            0.8622                 0.000000
Specificity                  0.94425            0.5998                 0.998786
Pos Pred Value               0.58763            0.6589                 0.000000
Neg Pred Value               0.91616            0.8292                 0.984440
Prevalence                   0.14226            0.4728                 0.015541
Detection Rate               0.06814            0.4077                 0.000000
Detection Prevalence         0.11596            0.6186                 0.001195
Balanced Accuracy            0.71162            0.7310                 0.499393
                     Class: Marlborough Class: New_York Class: Oregon
Sensitivity                    0.066667       0.0384615        0.4406
Specificity                    0.995700       0.9993928        0.8321
Pos Pred Value                 0.300000       0.5000000        0.5605
Neg Pred Value                 0.974744       0.9850389        0.7538
Prevalence                     0.026898       0.0155409        0.3270
Detection Rate                 0.001793       0.0005977        0.1441
Detection Prevalence           0.005977       0.0011955        0.2570
Balanced Accuracy              0.531183       0.5189272        0.6364</code></pre>
</div>
</div>
</section>
<section id="tuning-and-subsampling" class="slide level2">
<h2>Tuning and subsampling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">train</span>(province <span class="sc">~</span> .,</span>
<span id="cb68-2"><a></a>             <span class="at">data =</span> train, </span>
<span id="cb68-3"><a></a>             <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb68-4"><a></a>             <span class="at">tuneLength =</span> <span class="dv">15</span>,</span>
<span id="cb68-5"><a></a>             <span class="at">metric =</span> <span class="st">"Kappa"</span>, <span class="co"># this is new</span></span>
<span id="cb68-6"><a></a>             <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">number =</span> <span class="dv">1</span>))</span>
<span id="cb68-7"><a></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k-Nearest Neighbors 

6707 samples
  25 predictor
   6 classes: 'Burgundy', 'California', 'Casablanca_Valley', 'Marlborough', 'New_York', 'Oregon' 

No pre-processing
Resampling: Bootstrapped (1 reps) 
Summary of sample sizes: 6707 
Resampling results across tuning parameters:

  k   Accuracy   Kappa    
   5  0.5656934  0.3232469
   7  0.5863747  0.3473330
   9  0.6009732  0.3671785
  11  0.6107056  0.3797839
  13  0.6131387  0.3780861
  15  0.6163828  0.3791934
  17  0.6171938  0.3771433
  19  0.6220600  0.3838157
  21  0.6208435  0.3784326
  23  0.6248986  0.3851765
  25  0.6313869  0.3945933
  27  0.6313869  0.3937994
  29  0.6297648  0.3908459
  31  0.6313869  0.3919963
  33  0.6342255  0.3949258

Kappa was used to select the optimal model using the largest value.
The final value used for the model was k = 33.</code></pre>
</div>
</div>
</section>
<section id="tuning-plot" class="slide level2">
<h2>Tuning plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a></a><span class="fu">ggplot</span>(fit, <span class="at">metric=</span><span class="st">"Kappa"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="Session03_files/figure-revealjs/unnamed-chunk-42-1.png" width="960" class="r-stretch"></section>
<section id="group-modeling-problem-i" class="slide level2">
<h2>Group modeling problem I</h2>
<ul>
<li>Practice running different versions of the model</li>
<li>Create some new features and…</li>
<li>See if you can achieve a Kappa &gt;= 0.5!</li>
</ul>
<p><span class="math display">\[
\kappa \geq 0.5
\]</span></p>
</section>
<section id="bonus-knn-for-regression" class="slide level2">
<h2>Bonus: KNN for regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">train</span>(price <span class="sc">~</span> .,</span>
<span id="cb71-2"><a></a>             <span class="at">data =</span> train, </span>
<span id="cb71-3"><a></a>             <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb71-4"><a></a>             <span class="at">tuneLength =</span> <span class="dv">15</span>,</span>
<span id="cb71-5"><a></a>             <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">number =</span> <span class="dv">1</span>))</span>
<span id="cb71-6"><a></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k-Nearest Neighbors 

6707 samples
  25 predictor

No pre-processing
Resampling: Bootstrapped (1 reps) 
Summary of sample sizes: 6707 
Resampling results across tuning parameters:

  k   RMSE       Rsquared   MAE      
   5  0.7550158  0.4741054  0.5790215
   7  0.7465388  0.4840982  0.5738728
   9  0.7452802  0.4856900  0.5742805
  11  0.7423935  0.4894616  0.5725191
  13  0.7466887  0.4834923  0.5746681
  15  0.7455015  0.4857373  0.5726116
  17  0.7430564  0.4898004  0.5719122
  19  0.7398244  0.4957935  0.5707222
  21  0.7391951  0.4985767  0.5694352
  23  0.7385389  0.5004450  0.5676214
  25  0.7399677  0.4995457  0.5685243
  27  0.7405328  0.5004952  0.5685724
  29  0.7441326  0.4970277  0.5705210
  31  0.7446486  0.4960583  0.5701889
  33  0.7483131  0.4918859  0.5712325

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was k = 23.</code></pre>
</div>
</div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><a href="../index.html">Home</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>